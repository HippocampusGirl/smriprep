
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>smriprep.workflows.norm &#8212; smriprep version documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/banner.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for smriprep.workflows.norm</h1><div class="highlight"><pre>
<span></span><span class="c1"># emacs: -*- mode: python; py-indent-offset: 4; indent-tabs-mode: nil -*-</span>
<span class="c1"># vi: set ft=python sts=4 ts=4 sw=4 et:</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Spatial normalization workflows</span>
<span class="sd">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>

<span class="sd">.. autofunction:: init_anat_norm_wf</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">nipype.pipeline</span> <span class="k">import</span> <span class="n">engine</span> <span class="k">as</span> <span class="n">pe</span>
<span class="kn">from</span> <span class="nn">nipype.interfaces</span> <span class="k">import</span> <span class="n">utility</span> <span class="k">as</span> <span class="n">niu</span>

<span class="kn">from</span> <span class="nn">nipype.interfaces.ants.base</span> <span class="k">import</span> <span class="n">Info</span> <span class="k">as</span> <span class="n">ANTsInfo</span>

<span class="kn">from</span> <span class="nn">templateflow.api</span> <span class="k">import</span> <span class="n">get_metadata</span><span class="p">,</span> <span class="n">templates</span>
<span class="kn">from</span> <span class="nn">niworkflows.engine.workflows</span> <span class="k">import</span> <span class="n">LiterateWorkflow</span> <span class="k">as</span> <span class="n">Workflow</span>
<span class="kn">from</span> <span class="nn">niworkflows.interfaces.ants</span> <span class="k">import</span> <span class="n">ImageMath</span>
<span class="kn">from</span> <span class="nn">niworkflows.interfaces.mni</span> <span class="k">import</span> <span class="n">RobustMNINormalization</span>
<span class="kn">from</span> <span class="nn">niworkflows.interfaces.fixes</span> <span class="k">import</span> <span class="n">FixHeaderApplyTransforms</span> <span class="k">as</span> <span class="n">ApplyTransforms</span>
<span class="kn">from</span> <span class="nn">niworkflows.interfaces</span> <span class="k">import</span> <span class="n">SimpleBeforeAfter</span>
<span class="kn">from</span> <span class="nn">..interfaces</span> <span class="k">import</span> <span class="n">DerivativesDataSink</span>


<div class="viewcode-block" id="init_anat_norm_wf"><a class="viewcode-back" href="../../../api/smriprep.workflows.norm.html#smriprep.workflows.norm.init_anat_norm_wf">[docs]</a><span class="k">def</span> <span class="nf">init_anat_norm_wf</span><span class="p">(</span>
    <span class="n">debug</span><span class="p">,</span>
    <span class="n">omp_nthreads</span><span class="p">,</span>
    <span class="n">reportlets_dir</span><span class="p">,</span>
    <span class="n">template_list</span><span class="p">,</span>
    <span class="n">template_specs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An individual spatial normalization workflow using ``antsRegistration``.</span>

<span class="sd">    .. workflow ::</span>
<span class="sd">        :graph2use: orig</span>
<span class="sd">        :simple_form: yes</span>

<span class="sd">        from smriprep.workflows.norm import init_anat_norm_wf</span>
<span class="sd">        wf = init_anat_norm_wf(</span>
<span class="sd">            debug=False,</span>
<span class="sd">            omp_nthreads=1,</span>
<span class="sd">            reportlets_dir=&#39;.&#39;,</span>
<span class="sd">            template_list=[&#39;MNI152NLin2009cAsym&#39;, &#39;MNI152NLin6Asym&#39;],</span>
<span class="sd">        )</span>

<span class="sd">    **Parameters**</span>

<span class="sd">        debug : bool</span>
<span class="sd">            Apply sloppy arguments to speed up processing. Use with caution,</span>
<span class="sd">            registration processes will be very inaccurate.</span>
<span class="sd">        omp_nthreads : int</span>
<span class="sd">            Maximum number of threads an individual process may use.</span>
<span class="sd">        reportlets_dir : str</span>
<span class="sd">            Directory in which to save reportlets.</span>
<span class="sd">        template_list : list of str</span>
<span class="sd">            List of TemplateFlow identifiers (e.g. ``MNI152NLin6Asym``) that</span>
<span class="sd">            specifies the target template for spatial normalization. In the</span>
<span class="sd">            future, this parameter should accept also paths to custom/private</span>
<span class="sd">            templates with TemplateFlow&#39;s organization.</span>

<span class="sd">    **Inputs**</span>

<span class="sd">        moving_image</span>
<span class="sd">            The input image that will be normalized to standard space.</span>
<span class="sd">        moving_mask</span>
<span class="sd">            A precise brain mask separating skull/skin/fat from brain</span>
<span class="sd">            structures.</span>
<span class="sd">        moving_segmentation</span>
<span class="sd">            A brain tissue segmentation of the ``moving_image``.</span>
<span class="sd">        moving_tpms</span>
<span class="sd">            tissue probability maps (TPMs) corresponding to the</span>
<span class="sd">            ``moving_segmentation``.</span>
<span class="sd">        lesion_mask</span>
<span class="sd">            (optional) A mask to exclude regions from the cost-function</span>
<span class="sd">            input domain to enable standardization of lesioned brains.</span>
<span class="sd">        orig_t1w</span>
<span class="sd">            The original T1w image from the BIDS structure.</span>

<span class="sd">    **Outputs**</span>

<span class="sd">        warped</span>
<span class="sd">            The T1w after spatial normalization, in template space.</span>
<span class="sd">        forward_transform</span>
<span class="sd">            The T1w-to-template transform.</span>
<span class="sd">        reverse_transform</span>
<span class="sd">            The template-to-T1w transform.</span>
<span class="sd">        tpl_mask</span>
<span class="sd">            The ``moving_mask`` in template space (matches ``warped`` output).</span>
<span class="sd">        tpl_seg</span>
<span class="sd">            The ``moving_segmentation`` in template space (matches ``warped``</span>
<span class="sd">            output).</span>
<span class="sd">        tpl_tpms</span>
<span class="sd">            The ``moving_tpms`` in template space (matches ``warped`` output).</span>
<span class="sd">        template</span>
<span class="sd">            The input parameter ``template`` for further use in nodes depending</span>
<span class="sd">            on this</span>
<span class="sd">            workflow.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">template_list</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="n">template_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">template_list</span><span class="p">]</span>

    <span class="n">templateflow</span> <span class="o">=</span> <span class="n">templates</span><span class="p">()</span>
    <span class="n">missing_tpls</span> <span class="o">=</span> <span class="p">[</span><span class="n">template</span> <span class="k">for</span> <span class="n">template</span> <span class="ow">in</span> <span class="n">template_list</span> <span class="k">if</span> <span class="n">template</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">templateflow</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">missing_tpls</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">One or more templates were not found (</span><span class="si">%s</span><span class="s2">). Please make sure TemplateFlow is </span><span class="se">\</span>
<span class="s2">correctly installed and contains the given template identifiers.&quot;&quot;&quot;</span> <span class="o">%</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing_tpls</span><span class="p">))</span>

    <span class="n">workflow</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">(</span><span class="s1">&#39;anat_norm_wf&#39;</span><span class="p">)</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">__desc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">Volume-based spatial normalization to </span><span class="si">{targets}</span><span class="s2"> (</span><span class="si">{targets_id}</span><span class="s2">) was performed through</span>
<span class="s2">nonlinear registration with `antsRegistration` (ANTs </span><span class="si">{ants_ver}</span><span class="s2">),</span>
<span class="s2">using brain-extracted versions of both T1w reference and the T1w template.</span>
<span class="s2">The following template</span><span class="si">{tpls}</span><span class="s2"> selected for spatial normalization:</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">ants_ver</span><span class="o">=</span><span class="n">ANTsInfo</span><span class="o">.</span><span class="n">version</span><span class="p">()</span> <span class="ow">or</span> <span class="s1">&#39;(version unknown)&#39;</span><span class="p">,</span>
        <span class="n">targets</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> standard space</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">defaultdict</span><span class="p">(</span>
            <span class="s1">&#39;several&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">,</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;three&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="s1">&#39;four&#39;</span><span class="p">})[</span><span class="nb">len</span><span class="p">(</span><span class="n">template_list</span><span class="p">)],</span>
            <span class="s1">&#39;s&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">template_list</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)),</span>
        <span class="n">targets_id</span><span class="o">=</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">template_list</span><span class="p">),</span>
        <span class="n">tpls</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39; was&#39;</span><span class="p">,</span> <span class="s1">&#39;s were&#39;</span><span class="p">)[</span><span class="nb">len</span><span class="p">(</span><span class="n">template_list</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">template_specs</span><span class="p">:</span>
        <span class="n">template_specs</span> <span class="o">=</span> <span class="p">[{}]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">template_list</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">template_list</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">template_specs</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Number of templates (</span><span class="si">%d</span><span class="s1">) doesn</span><span class="se">\&#39;</span><span class="s1">t match the number of specs &#39;</span>
                           <span class="s1">&#39;(</span><span class="si">%d</span><span class="s1">) provided.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">template_list</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">template_specs</span><span class="p">)))</span>

    <span class="c1"># Append template citations to description</span>
    <span class="k">for</span> <span class="n">template</span> <span class="ow">in</span> <span class="n">template_list</span><span class="p">:</span>
        <span class="n">template_meta</span> <span class="o">=</span> <span class="n">get_metadata</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
        <span class="n">template_refs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;@</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">template</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>

        <span class="k">if</span> <span class="n">template_meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RRID&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">template_refs</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;RRID:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">template_meta</span><span class="p">[</span><span class="s1">&#39;RRID&#39;</span><span class="p">]]</span>

        <span class="n">workflow</span><span class="o">.</span><span class="n">__desc__</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">*</span><span class="si">{template_name}</span><span class="s2">* [</span><span class="si">{template_refs}</span><span class="s2">; TemplateFlow ID: </span><span class="si">{template}</span><span class="s2">]&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">template</span><span class="o">=</span><span class="n">template</span><span class="p">,</span>
            <span class="n">template_name</span><span class="o">=</span><span class="n">template_meta</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">],</span>
            <span class="n">template_refs</span><span class="o">=</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">template_refs</span><span class="p">))</span>
        <span class="n">workflow</span><span class="o">.</span><span class="n">__desc__</span> <span class="o">+=</span> <span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="n">template</span> <span class="o">==</span> <span class="n">template_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

    <span class="n">inputnode</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">niu</span><span class="o">.</span><span class="n">IdentityInterface</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span>
        <span class="s1">&#39;moving_image&#39;</span><span class="p">,</span> <span class="s1">&#39;moving_mask&#39;</span><span class="p">,</span> <span class="s1">&#39;moving_segmentation&#39;</span><span class="p">,</span> <span class="s1">&#39;moving_tpms&#39;</span><span class="p">,</span>
        <span class="s1">&#39;lesion_mask&#39;</span><span class="p">,</span> <span class="s1">&#39;orig_t1w&#39;</span><span class="p">,</span> <span class="s1">&#39;template&#39;</span><span class="p">]),</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;inputnode&#39;</span><span class="p">)</span>
    <span class="n">inputnode</span><span class="o">.</span><span class="n">iterables</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;template&#39;</span><span class="p">,</span> <span class="n">template_list</span><span class="p">)]</span>
    <span class="n">out_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;warped&#39;</span><span class="p">,</span> <span class="s1">&#39;forward_transform&#39;</span><span class="p">,</span> <span class="s1">&#39;reverse_transform&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;tpl_mask&#39;</span><span class="p">,</span> <span class="s1">&#39;tpl_seg&#39;</span><span class="p">,</span> <span class="s1">&#39;tpl_tpms&#39;</span><span class="p">,</span> <span class="s1">&#39;template&#39;</span><span class="p">]</span>
    <span class="n">poutputnode</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">niu</span><span class="o">.</span><span class="n">IdentityInterface</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="n">out_fields</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;poutputnode&#39;</span><span class="p">)</span>

    <span class="n">tpl_specs</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">niu</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span>
        <span class="n">function</span><span class="o">=</span><span class="n">_select_specs</span><span class="p">,</span>
        <span class="n">input_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">,</span> <span class="s1">&#39;template_list&#39;</span><span class="p">,</span> <span class="s1">&#39;template_specs&#39;</span><span class="p">,</span> <span class="s1">&#39;force_res&#39;</span><span class="p">]),</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;tpl_specs&#39;</span><span class="p">,</span> <span class="n">run_without_submitting</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">tpl_specs</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">template_list</span> <span class="o">=</span> <span class="n">template_list</span>
    <span class="n">tpl_specs</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">template_specs</span> <span class="o">=</span> <span class="n">template_specs</span>
    <span class="n">tpl_specs</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">force_res</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">tpl_select</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">niu</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="n">function</span><span class="o">=</span><span class="n">_get_template</span><span class="p">),</span>
                         <span class="n">name</span><span class="o">=</span><span class="s1">&#39;tpl_select&#39;</span><span class="p">,</span> <span class="n">run_without_submitting</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># With the improvements from poldracklab/niworkflows#342 this truncation is now necessary</span>
    <span class="n">trunc_mov</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">ImageMath</span><span class="p">(</span><span class="n">operation</span><span class="o">=</span><span class="s1">&#39;TruncateImageIntensity&#39;</span><span class="p">,</span> <span class="n">op2</span><span class="o">=</span><span class="s1">&#39;0.01 0.999 256&#39;</span><span class="p">),</span>
                        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;trunc_mov&#39;</span><span class="p">)</span>

    <span class="n">registration</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">RobustMNINormalization</span><span class="p">(</span>
        <span class="nb">float</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">flavor</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;precise&#39;</span><span class="p">,</span> <span class="s1">&#39;testing&#39;</span><span class="p">][</span><span class="n">debug</span><span class="p">],</span>
    <span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;registration&#39;</span><span class="p">,</span> <span class="n">n_procs</span><span class="o">=</span><span class="n">omp_nthreads</span><span class="p">,</span> <span class="n">mem_gb</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Resample T1w-space inputs</span>
    <span class="n">tpl_moving</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">ApplyTransforms</span><span class="p">(</span>
        <span class="n">dimension</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">float</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;LanczosWindowedSinc&#39;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;tpl_moving&#39;</span><span class="p">)</span>
    <span class="n">tpl_mask</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">ApplyTransforms</span><span class="p">(</span><span class="n">dimension</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">float</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                       <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;MultiLabel&#39;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;tpl_mask&#39;</span><span class="p">)</span>

    <span class="n">tpl_seg</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">ApplyTransforms</span><span class="p">(</span><span class="n">dimension</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">float</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                      <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;MultiLabel&#39;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;tpl_seg&#39;</span><span class="p">)</span>

    <span class="n">tpl_tpms</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">MapNode</span><span class="p">(</span><span class="n">ApplyTransforms</span><span class="p">(</span><span class="n">dimension</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">float</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                          <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;Gaussian&#39;</span><span class="p">),</span>
                          <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;input_image&#39;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;tpl_tpms&#39;</span><span class="p">)</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">connect</span><span class="p">([</span>
        <span class="p">(</span><span class="n">inputnode</span><span class="p">,</span> <span class="n">tpl_specs</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;template&#39;</span><span class="p">,</span> <span class="s1">&#39;template&#39;</span><span class="p">)]),</span>
        <span class="p">(</span><span class="n">inputnode</span><span class="p">,</span> <span class="n">tpl_select</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;template&#39;</span><span class="p">,</span> <span class="s1">&#39;template&#39;</span><span class="p">)]),</span>
        <span class="p">(</span><span class="n">inputnode</span><span class="p">,</span> <span class="n">registration</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;template&#39;</span><span class="p">,</span> <span class="s1">&#39;template&#39;</span><span class="p">)]),</span>
        <span class="p">(</span><span class="n">inputnode</span><span class="p">,</span> <span class="n">trunc_mov</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;moving_image&#39;</span><span class="p">,</span> <span class="s1">&#39;op1&#39;</span><span class="p">)]),</span>
        <span class="p">(</span><span class="n">inputnode</span><span class="p">,</span> <span class="n">registration</span><span class="p">,</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;moving_mask&#39;</span><span class="p">,</span> <span class="s1">&#39;moving_mask&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;lesion_mask&#39;</span><span class="p">,</span> <span class="s1">&#39;lesion_mask&#39;</span><span class="p">)]),</span>
        <span class="p">(</span><span class="n">inputnode</span><span class="p">,</span> <span class="n">tpl_moving</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;moving_image&#39;</span><span class="p">,</span> <span class="s1">&#39;input_image&#39;</span><span class="p">)]),</span>
        <span class="p">(</span><span class="n">inputnode</span><span class="p">,</span> <span class="n">tpl_mask</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;moving_mask&#39;</span><span class="p">,</span> <span class="s1">&#39;input_image&#39;</span><span class="p">)]),</span>
        <span class="p">(</span><span class="n">tpl_specs</span><span class="p">,</span> <span class="n">tpl_select</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;out&#39;</span><span class="p">,</span> <span class="s1">&#39;template_spec&#39;</span><span class="p">)]),</span>
        <span class="p">(</span><span class="n">tpl_specs</span><span class="p">,</span> <span class="n">registration</span><span class="p">,</span> <span class="p">[((</span><span class="s1">&#39;out&#39;</span><span class="p">,</span> <span class="n">_drop_res</span><span class="p">),</span> <span class="s1">&#39;template_spec&#39;</span><span class="p">)]),</span>
        <span class="p">(</span><span class="n">tpl_select</span><span class="p">,</span> <span class="n">tpl_moving</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;out&#39;</span><span class="p">,</span> <span class="s1">&#39;reference_image&#39;</span><span class="p">)]),</span>
        <span class="p">(</span><span class="n">tpl_select</span><span class="p">,</span> <span class="n">tpl_mask</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;out&#39;</span><span class="p">,</span> <span class="s1">&#39;reference_image&#39;</span><span class="p">)]),</span>
        <span class="p">(</span><span class="n">tpl_select</span><span class="p">,</span> <span class="n">tpl_seg</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;out&#39;</span><span class="p">,</span> <span class="s1">&#39;reference_image&#39;</span><span class="p">)]),</span>
        <span class="p">(</span><span class="n">tpl_select</span><span class="p">,</span> <span class="n">tpl_tpms</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;out&#39;</span><span class="p">,</span> <span class="s1">&#39;reference_image&#39;</span><span class="p">)]),</span>
        <span class="p">(</span><span class="n">trunc_mov</span><span class="p">,</span> <span class="n">registration</span><span class="p">,</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;output_image&#39;</span><span class="p">,</span> <span class="s1">&#39;moving_image&#39;</span><span class="p">)]),</span>
        <span class="p">(</span><span class="n">registration</span><span class="p">,</span> <span class="n">tpl_moving</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;composite_transform&#39;</span><span class="p">,</span> <span class="s1">&#39;transforms&#39;</span><span class="p">)]),</span>
        <span class="p">(</span><span class="n">registration</span><span class="p">,</span> <span class="n">tpl_mask</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;composite_transform&#39;</span><span class="p">,</span> <span class="s1">&#39;transforms&#39;</span><span class="p">)]),</span>
        <span class="p">(</span><span class="n">inputnode</span><span class="p">,</span> <span class="n">tpl_seg</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;moving_segmentation&#39;</span><span class="p">,</span> <span class="s1">&#39;input_image&#39;</span><span class="p">)]),</span>
        <span class="p">(</span><span class="n">registration</span><span class="p">,</span> <span class="n">tpl_seg</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;composite_transform&#39;</span><span class="p">,</span> <span class="s1">&#39;transforms&#39;</span><span class="p">)]),</span>
        <span class="p">(</span><span class="n">inputnode</span><span class="p">,</span> <span class="n">tpl_tpms</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;moving_tpms&#39;</span><span class="p">,</span> <span class="s1">&#39;input_image&#39;</span><span class="p">)]),</span>
        <span class="p">(</span><span class="n">registration</span><span class="p">,</span> <span class="n">tpl_tpms</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;composite_transform&#39;</span><span class="p">,</span> <span class="s1">&#39;transforms&#39;</span><span class="p">)]),</span>
        <span class="p">(</span><span class="n">registration</span><span class="p">,</span> <span class="n">poutputnode</span><span class="p">,</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;composite_transform&#39;</span><span class="p">,</span> <span class="s1">&#39;forward_transform&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;inverse_composite_transform&#39;</span><span class="p">,</span> <span class="s1">&#39;reverse_transform&#39;</span><span class="p">)]),</span>
        <span class="p">(</span><span class="n">tpl_moving</span><span class="p">,</span> <span class="n">poutputnode</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;output_image&#39;</span><span class="p">,</span> <span class="s1">&#39;warped&#39;</span><span class="p">)]),</span>
        <span class="p">(</span><span class="n">tpl_mask</span><span class="p">,</span> <span class="n">poutputnode</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;output_image&#39;</span><span class="p">,</span> <span class="s1">&#39;tpl_mask&#39;</span><span class="p">)]),</span>
        <span class="p">(</span><span class="n">tpl_seg</span><span class="p">,</span> <span class="n">poutputnode</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;output_image&#39;</span><span class="p">,</span> <span class="s1">&#39;tpl_seg&#39;</span><span class="p">)]),</span>
        <span class="p">(</span><span class="n">tpl_tpms</span><span class="p">,</span> <span class="n">poutputnode</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;output_image&#39;</span><span class="p">,</span> <span class="s1">&#39;tpl_tpms&#39;</span><span class="p">)]),</span>
        <span class="p">(</span><span class="n">inputnode</span><span class="p">,</span> <span class="n">poutputnode</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;template&#39;</span><span class="p">,</span> <span class="s1">&#39;template&#39;</span><span class="p">)]),</span>
    <span class="p">])</span>

    <span class="c1"># Generate and store report</span>
    <span class="n">msk_select</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">niu</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span>
        <span class="n">function</span><span class="o">=</span><span class="n">_get_template</span><span class="p">,</span>
        <span class="n">input_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">,</span> <span class="s1">&#39;template_spec&#39;</span><span class="p">,</span> <span class="s1">&#39;suffix&#39;</span><span class="p">,</span> <span class="s1">&#39;desc&#39;</span><span class="p">]),</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;msk_select&#39;</span><span class="p">,</span> <span class="n">run_without_submitting</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">msk_select</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">desc</span> <span class="o">=</span> <span class="s1">&#39;brain&#39;</span>
    <span class="n">msk_select</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;mask&#39;</span>

    <span class="n">norm_msk</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">niu</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span>
        <span class="n">function</span><span class="o">=</span><span class="n">_rpt_masks</span><span class="p">,</span> <span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;before&#39;</span><span class="p">,</span> <span class="s1">&#39;after&#39;</span><span class="p">],</span>
        <span class="n">input_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mask_file&#39;</span><span class="p">,</span> <span class="s1">&#39;before&#39;</span><span class="p">,</span> <span class="s1">&#39;after&#39;</span><span class="p">,</span> <span class="s1">&#39;after_mask&#39;</span><span class="p">]),</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;norm_msk&#39;</span><span class="p">)</span>
    <span class="n">norm_rpt</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">SimpleBeforeAfter</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;norm_rpt&#39;</span><span class="p">,</span> <span class="n">mem_gb</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">norm_rpt</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">after_label</span> <span class="o">=</span> <span class="s1">&#39;Participant&#39;</span>  <span class="c1"># after</span>

    <span class="n">ds_t1_2_tpl_report</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
        <span class="n">DerivativesDataSink</span><span class="p">(</span><span class="n">base_directory</span><span class="o">=</span><span class="n">reportlets_dir</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;T1w&#39;</span><span class="p">),</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ds_t1_2_tpl_report&#39;</span><span class="p">,</span> <span class="n">run_without_submitting</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">workflow</span><span class="o">.</span><span class="n">connect</span><span class="p">([</span>
        <span class="p">(</span><span class="n">inputnode</span><span class="p">,</span> <span class="n">msk_select</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;template&#39;</span><span class="p">,</span> <span class="s1">&#39;template&#39;</span><span class="p">)]),</span>
        <span class="p">(</span><span class="n">inputnode</span><span class="p">,</span> <span class="n">norm_rpt</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;template&#39;</span><span class="p">,</span> <span class="s1">&#39;before_label&#39;</span><span class="p">)]),</span>
        <span class="p">(</span><span class="n">tpl_mask</span><span class="p">,</span> <span class="n">norm_msk</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;output_image&#39;</span><span class="p">,</span> <span class="s1">&#39;after_mask&#39;</span><span class="p">)]),</span>
        <span class="p">(</span><span class="n">tpl_specs</span><span class="p">,</span> <span class="n">msk_select</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;out&#39;</span><span class="p">,</span> <span class="s1">&#39;template_spec&#39;</span><span class="p">)]),</span>
        <span class="p">(</span><span class="n">msk_select</span><span class="p">,</span> <span class="n">norm_msk</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;out&#39;</span><span class="p">,</span> <span class="s1">&#39;mask_file&#39;</span><span class="p">)]),</span>
        <span class="p">(</span><span class="n">tpl_select</span><span class="p">,</span> <span class="n">norm_msk</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;out&#39;</span><span class="p">,</span> <span class="s1">&#39;before&#39;</span><span class="p">)]),</span>
        <span class="p">(</span><span class="n">tpl_moving</span><span class="p">,</span> <span class="n">norm_msk</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;output_image&#39;</span><span class="p">,</span> <span class="s1">&#39;after&#39;</span><span class="p">)]),</span>
        <span class="p">(</span><span class="n">norm_msk</span><span class="p">,</span> <span class="n">norm_rpt</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;before&#39;</span><span class="p">,</span> <span class="s1">&#39;before&#39;</span><span class="p">),</span>
                              <span class="p">(</span><span class="s1">&#39;after&#39;</span><span class="p">,</span> <span class="s1">&#39;after&#39;</span><span class="p">)]),</span>
        <span class="p">(</span><span class="n">inputnode</span><span class="p">,</span> <span class="n">ds_t1_2_tpl_report</span><span class="p">,</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;template&#39;</span><span class="p">,</span> <span class="s1">&#39;space&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;orig_t1w&#39;</span><span class="p">,</span> <span class="s1">&#39;source_file&#39;</span><span class="p">)]),</span>
        <span class="p">(</span><span class="n">norm_rpt</span><span class="p">,</span> <span class="n">ds_t1_2_tpl_report</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;out_report&#39;</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)]),</span>
    <span class="p">])</span>

    <span class="c1"># Provide synchronized output</span>
    <span class="n">outputnode</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">JoinNode</span><span class="p">(</span><span class="n">niu</span><span class="o">.</span><span class="n">IdentityInterface</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="n">out_fields</span><span class="p">),</span>
                             <span class="n">name</span><span class="o">=</span><span class="s1">&#39;outputnode&#39;</span><span class="p">,</span> <span class="n">joinsource</span><span class="o">=</span><span class="s1">&#39;inputnode&#39;</span><span class="p">)</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">connect</span><span class="p">([</span>
        <span class="p">(</span><span class="n">poutputnode</span><span class="p">,</span> <span class="n">outputnode</span><span class="p">,</span> <span class="p">[(</span><span class="n">f</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">out_fields</span><span class="p">]),</span>
    <span class="p">])</span>

    <span class="k">return</span> <span class="n">workflow</span></div>


<span class="k">def</span> <span class="nf">_rpt_masks</span><span class="p">(</span><span class="n">mask_file</span><span class="p">,</span> <span class="n">before</span><span class="p">,</span> <span class="n">after</span><span class="p">,</span> <span class="n">after_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">os.path</span> <span class="k">import</span> <span class="n">abspath</span>
    <span class="kn">import</span> <span class="nn">nibabel</span> <span class="k">as</span> <span class="nn">nb</span>
    <span class="n">msk</span> <span class="o">=</span> <span class="n">nb</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">mask_file</span><span class="p">)</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="n">bnii</span> <span class="o">=</span> <span class="n">nb</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">before</span><span class="p">)</span>
    <span class="n">nb</span><span class="o">.</span><span class="n">Nifti1Image</span><span class="p">(</span><span class="n">bnii</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span> <span class="o">*</span> <span class="n">msk</span><span class="p">,</span>
                   <span class="n">bnii</span><span class="o">.</span><span class="n">affine</span><span class="p">,</span> <span class="n">bnii</span><span class="o">.</span><span class="n">header</span><span class="p">)</span><span class="o">.</span><span class="n">to_filename</span><span class="p">(</span><span class="s1">&#39;before.nii.gz&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">after_mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">msk</span> <span class="o">=</span> <span class="n">nb</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">after_mask</span><span class="p">)</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="n">anii</span> <span class="o">=</span> <span class="n">nb</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">after</span><span class="p">)</span>
    <span class="n">nb</span><span class="o">.</span><span class="n">Nifti1Image</span><span class="p">(</span><span class="n">anii</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span> <span class="o">*</span> <span class="n">msk</span><span class="p">,</span>
                   <span class="n">anii</span><span class="o">.</span><span class="n">affine</span><span class="p">,</span> <span class="n">anii</span><span class="o">.</span><span class="n">header</span><span class="p">)</span><span class="o">.</span><span class="n">to_filename</span><span class="p">(</span><span class="s1">&#39;after.nii.gz&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;before.nii.gz&#39;</span><span class="p">),</span> <span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;after.nii.gz&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_select_specs</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">template_list</span><span class="p">,</span> <span class="n">template_specs</span><span class="p">,</span> <span class="n">force_res</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">out_spec</span> <span class="o">=</span> <span class="n">template_specs</span><span class="p">[</span><span class="n">template_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">template</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">force_res</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">out_spec</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;res&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">out_spec</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;resoluton&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">out_spec</span><span class="p">[</span><span class="s1">&#39;res&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">force_res</span>

    <span class="k">return</span> <span class="n">out_spec</span>


<span class="k">def</span> <span class="nf">_get_template</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">template_spec</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;T1w&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">niworkflows.utils.misc</span> <span class="k">import</span> <span class="n">get_template_specs</span>
    <span class="n">template_spec</span><span class="p">[</span><span class="s1">&#39;suffix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">suffix</span>
    <span class="n">template_spec</span><span class="p">[</span><span class="s1">&#39;desc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">desc</span>
    <span class="k">return</span> <span class="n">get_template_specs</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">template_spec</span><span class="o">=</span><span class="n">template_spec</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">_drop_res</span><span class="p">(</span><span class="n">in_dict</span><span class="p">):</span>
    <span class="n">in_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;res&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">in_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;resoluton&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">in_dict</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3>Versions</h3>
<ul>
    <li><a href="norm.html">ci_doc_deploy</a></li>
    <li><a href="../../../../doc_test/index.html">doc_test</a></li>
    <li><a href="../../../../doc_test_1/index.html">doc_test_1</a></li>
    <li><a href="../../../../doc_test_2/index.html">doc_test_2</a></li>
</ul>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, The sMRIPrep Developers.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.2.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>